/**
 * Created by emiliano.barbosa on 02/05/14.
 */
var FB_ROOT = 'https://necp.firebaseio.com/podcasts';
var mysql      = require('mysql');
var connection = mysql.createConnection({
    port     : 8889,
    host     : 'localhost',
    user     : 'root',
    password : 'root',
    database : 'fxos_players'
});
var Firebase = require('firebase');
var myRootRef = new Firebase('https://necp.firebaseio.com/podcasts');

var getPodcastRoot = function(podcastKey){

    firebasePodcastListKey = [];
    firebasePodcastListObject = [];

    if(firebasePodcastListKey.indexOf(podcastKey) == -1 ){
        firebasePodcastListKey.push( podcastKey );
        firebasePodcastListObject[podcastKey] = new Firebase('https://necp.firebaseio.com/'+podcastKey);
    }

    return firebasePodcastListObject[podcastKey];

}

connection.connect(function(err) {
    console.log('MySQL', 'error', err);
});

exports.insert = function(item, success, error){

    // getPodcastRoot(item['podcast']).push().set(item);

    delete item['categories'];
    var query = connection.query('INSERT INTO podcasts SET ?', item, success, error);

}

exports.list = function(success, error){
    var queryString = 'SELECT * FROM podcasts';
    connection.query(queryString, function(err, rows, fields) {
        if (err) throw err;

        for (var i in rows) {
            console.log('Nerdcast Titles: ', rows[i].title);
        }
    });
}

exports.get = function(podcastModel, success, error){
    var fields = ['id','name'];
    var queryString = 'SELECT * FROM podcasts WHERE podcast = ? AND title = ?';
    connection.query(queryString, [podcastModel.podcast, podcastModel.title], function(err, rows, fields) {
        if (err) {
            error(err)
        } else {
            success(rows);
        }
    });
}