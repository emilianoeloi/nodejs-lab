var FeedParser = require('feedparser'),
    request = require('request');

exports.readFeed = function(feedUrl, ){
    var req = request(options.url);
    var feedparser = new FeedParser();

    req.on('error', function (error) {
        console.log(error);
    });
    req.on('response', function (res) {
        var stream = this;
        if (res.statusCode != 200) return this.emit('error', new Error('Bad status code'));
        stream.pipe(feedparser);
    });

    feedparser.on('error', function(error) {
    });

    feedparser.on('close', function(error) {
        console.log("fechado...");
    });

    feedparser.on('end', function(error) {
        console.log("fim de tudo");
        callback();
    });

    feedparser.on('complete', function(a) {
        console.log('complete',a);
    });

    feedparser.on('readable', function() {
        var stream = this,
            podLocal = new PodcastController(stream.read(), globalOptions.separator, globalOptions.remove),
            podcastItem = podLocal.getObject();
        success(podcastItem);
        count++;
    });
}
setEvents(req, feedparser, callback, success);

